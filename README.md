# Ujin Smart Home - Home Assistant Integration

–ö–∞—Å—Ç–æ–º–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–º–Ω—ã–º –¥–æ–º–æ–º Ujin (—Ä–∞–Ω–µ–µ MySmartFlat/Sapfir) —á–µ—Ä–µ–∑ Home Assistant.

## ‚úÖ –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è **–ì–û–¢–û–í–ê –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ**! –í—Å–µ –±–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ–º (–≤–∫–ª/–≤—ã–∫–ª)
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–∑–µ—Ç–∫–∞–º–∏
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–æ—Ç–µ—á–∫–∏ –≤–æ–¥—ã (Ujin Aqua)
- ‚úÖ –î–∏–º–º–∏—Ä—É–µ–º–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ (Ujin Connect-dim)
- ‚úÖ –†–µ–ª–µ –Ω–∞ DIN-—Ä–µ–π–∫—É (Ujin Connect-din)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)
- ‚úÖ Email-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å –∫–æ–¥–æ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞–º–∏
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω–æ–µ –∏ –æ–±–ª–∞—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –í—Ä—É—á–Ω—É—é

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–∞–ø–∫—É `custom_components/ujin` –≤ –ø–∞–ø–∫—É `config/custom_components/` –≤–∞—à–µ–≥–æ Home Assistant:

```bash
cd /config
mkdir -p custom_components
cp -r /path/to/ujin-hassio/custom_components/ujin custom_components/
```

2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Home Assistant

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ HACS (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ HACS –≤ Home Assistant
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ç—Ä–∏ —Ç–æ—á–∫–∏ –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
3. –í—ã–±–µ—Ä–∏—Ç–µ "Custom repositories"
4. –î–æ–±–∞–≤—å—Ç–µ URL —ç—Ç–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é "Ujin Smart Home"
6. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Home Assistant

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ —Å–ª—É–∂–±—ã**
2. –ù–∞–∂–º–∏—Ç–µ **+ –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é**
3. –ù–∞–π–¥–∏—Ç–µ **Ujin Smart Home**
4. –í–≤–µ–¥–∏—Ç–µ –≤–∞—à **email**, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Ujin
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É –∏ –≤–≤–µ–¥–∏—Ç–µ **–∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è** –∏–∑ –ø–∏—Å—å–º–∞
6. –ì–æ—Ç–æ–≤–æ! –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:

#### ‚úÖ –†–µ–ª–µ –∏ –≤—ã–∫–ª—é—á–∞—Ç–µ–ª–∏
- **Ujin Connect-din** (dinrelay_m4) - –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä –Ω–∞ DIN-—Ä–µ–π–∫—É, –¥–æ 4 –∫–∞–Ω–∞–ª–æ–≤
- **Ujin Connect-dim** (ujin-zdm-m2) - –¥–∏–º–º–∏—Ä—É–µ–º–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ, 2 –∫–∞–Ω–∞–ª–∞

#### ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å –≤–æ–¥—ã
- **Ujin Aqua** (ujin-zld-m1) - –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø—Ä–æ—Ç–µ—á–∫–∏ —Å —ç–ª–µ–∫—Ç—Ä–æ–ø—Ä–∏–≤–æ–¥–Ω—ã–º –∫—Ä–∞–Ω–æ–º

–í—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ `switch` —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å—Ç–∞—Ç—É—Å–µ, –∫–æ–º–Ω–∞—Ç–µ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
ujin-hassio/
‚îú‚îÄ‚îÄ custom_components/ujin/    # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Home Assistant
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ api.py                 # –ö–ª–∏–µ–Ω—Ç Ujin API
‚îÇ   ‚îú‚îÄ‚îÄ config_flow.py
‚îÇ   ‚îú‚îÄ‚îÄ const.py
‚îÇ   ‚îú‚îÄ‚îÄ switch.py              # ‚úÖ –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ switch
‚îÇ   ‚îî‚îÄ‚îÄ manifest.json
‚îî‚îÄ‚îÄ docs/                      # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
    ‚îú‚îÄ‚îÄ api/API_SUMMARY.md     # –û–ø–∏—Å–∞–Ω–∏–µ API
    ‚îú‚îÄ‚îÄ EXAMPLES.md            # –ü—Ä–∏–º–µ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–π
    ‚îú‚îÄ‚îÄ QUICK_START.md         # –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
    ‚îî‚îÄ‚îÄ CHANGELOG.md           # –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
```

## API

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API Ujin:

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ endpoints:

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:**
```
POST /api/v1/auth/code/email/send/   - –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞ –Ω–∞ email
POST /api/v1/auth/code/email/auth/   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
GET  /api/v1/auth/user/               - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

**–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:**
```
GET /api/devices/main/                - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
GET /api/devices/wss/                 - WebSocket URL –¥–ª—è real-time
GET /api/devices/get-device-...       - –î–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
```

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```
GET /api/apartment/send-signal/       - –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É
    –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: serialnumber, signal, state (0/1)
```

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:

```json
{
  "id": "5360142",
  "signal": "rele1",
  "name": "–û—Å–≤–µ—â–µ–Ω–∏–µ",
  "model": "dinrelay_m4",
  "status": "ok",
  "status_title": "–û–Ω–ª–∞–π–Ω",
  "room": {"title": "–ü—Ä–∏—Ö–æ–∂–∞—è"},
  "controls": [{"type": "switch", "value": 1}],
  "management": {
    "local": {
      "ip": "10.10.30.50",
      "protocol": "sapfir-unicast"
    }
  }
}
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- üìñ [docs/QUICK_START.md](docs/QUICK_START.md) - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- üìñ [docs/EXAMPLES.md](docs/EXAMPLES.md) - –ü—Ä–∏–º–µ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–π
- üìñ [docs/api/API_SUMMARY.md](docs/api/API_SUMMARY.md) - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
- üìñ [docs/](docs/) - –í—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

- [ ] WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤–º–µ—Å—Ç–æ polling
- [ ] –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ binary_sensor –¥–ª—è –¥–∞—Ç—á–∏–∫–æ–≤
- [ ] –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ sensor –¥–ª—è –ø–æ–∫–∞–∑–∞–Ω–∏–π
- [ ] –õ–æ–∫–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ sapfir-unicast
- [ ] –ê–≤—Ç–æ—Å–∫—Ä–∏–ø—Ç—ã –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏ Ujin
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

## –ò–∫–æ–Ω–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

–î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∫–æ–Ω–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ Home Assistant UI –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –µ—ë –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π [brands repository](https://github.com/home-assistant/brands).

### –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –∏–∫–æ–Ω–∫—É

1. –§–æ—Ä–∫–Ω–∏—Ç–µ https://github.com/home-assistant/brands
2. –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É `custom_integrations/ujin/`
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ `brands_submission/ujin/`:
   - `icon.png` (256√ó256)
   - `icon@2x.png` (512√ó512)
4. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ `brands_submission/`.

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11+
- Home Assistant 2024.1+
- aiohttp

### –û—Ç–ª–∞–¥–∫–∞

–í–∫–ª—é—á–∏—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `configuration.yaml`:

```yaml
logger:
  default: info
  logs:
    custom_components.ujin: debug
```

## –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–º–æ—á—å —Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π:

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –≤–∞—à–µ–π —Ñ—É–Ω–∫—Ü–∏–∏
3. –°–¥–µ–ª–∞–π—Ç–µ –∫–æ–º–º–∏—Ç –≤–∞—à–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ pull request

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## Disclaimer

–≠—Ç–æ –Ω–µ–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω–∞—è —Å –∫–æ–º–ø–∞–Ω–∏–µ–π Ujin. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞ —Å–≤–æ–π —Ä–∏—Å–∫.

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Home Assistant](https://www.home-assistant.io/)
- [Home Assistant Developers](https://developers.home-assistant.io/)
- [–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Ujin –≤ Google Play](https://play.google.com/store/apps/details?id=ru.mysmartflat.sapfir)

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã, —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
